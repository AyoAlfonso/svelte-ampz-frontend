'use strict';

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var index = require('./index-7460d1f3.js');
require('./index-1604aca7.js');
var Cookie = _interopDefault(require('cookie-universal'));
require('./api-80ace8cf.js');
var app = require('./app-1c31723f.js');
var Textbox = require('./Textbox-07818637.js');
require('./index-eb724975.js');
var Passwordbox = require('./Passwordbox-655725d2.js');
var Header = require('./Header-8503da6b.js');
require('./auth-2eda1a30.js');
require('./cart-79bd70c1.js');

/* src/routes/#234234login.svelte generated by Svelte v3.16.0 */

const css = {
	code: ".container.svelte-14pnfkc{max-height:80vh !important;min-height:80vh !important}.wraper-hide.svelte-14pnfkc{visibility:hidden}.otp-container.svelte-14pnfkc{height:48px;width:136px;background-color:#eff1f4;border-radius:4px;position:relative;display:inline-block}.otp-container.svelte-14pnfkc .otp-seperator.svelte-14pnfkc{background-color:#dfe1e6;border:1px solid #dfe1e6}.otp-container.svelte-14pnfkc #wraper1.svelte-14pnfkc{top:20px;left:28px}.otp-container.svelte-14pnfkc #wraper2.svelte-14pnfkc{top:20px;left:51px}.otp-container.svelte-14pnfkc #wraper3.svelte-14pnfkc{top:20px;left:76px}.otp-container.svelte-14pnfkc #wraper4.svelte-14pnfkc{top:20px;left:100px}.otp-container.svelte-14pnfkc .otp-content.svelte-14pnfkc{height:inherit;width:150px;background-color:transparent;border:1px solid transparent;outline:transparent;letter-spacing:15px;font-size:22px;padding-left:16px}",
	map: "{\"version\":3,\"file\":\"#234234login.svelte\",\"sources\":[\"#234234login.svelte\"],\"sourcesContent\":[\"<script>\\n  import { stores, goto } from \\\"@sapper/app\\\";\\n  const { session, page } = stores();\\n  import { get, put, post } from \\\"./../lib/api\\\";\\n  import Cookie from \\\"cookie-universal\\\";\\n  const cookies = Cookie();\\n  import { toast } from \\\"./../actions/toast.js\\\";\\n  import Textbox from \\\"./../components/ui/Textbox.svelte\\\";\\n  import Passwordbox from \\\"./../components/ui/Passwordbox.svelte\\\";\\n  import Header from \\\"./../components/Header.svelte\\\";\\n  import { fadeIn, fadeOut } from \\\"./../actions/pageFade\\\";\\n  let loading = false,\\n    disable = \\\"disable\\\",\\n    p = {},\\n    msg = null,\\n    signup = false,\\n    uid = \\\"\\\",\\n    password = \\\"\\\",\\n    firstName = \\\"\\\",\\n    lastName = \\\"\\\",\\n    otp = \\\"\\\",\\n    showOTP = false,\\n    phoneno = /^[+()\\\\d-]+$/,\\n    submitText = \\\"Verify\\\",\\n    err = null;\\n  $: isEmail = uid.includes(\\\"@\\\");\\n  $: isPhone = uid.length >= 10 && uid.match(phoneno) ? true : false;\\n  $: if (otp) {\\n    if (otp.length == 4) {\\n      phoneLogin();\\n    }\\n  }\\n  $: if (uid) {\\n    showOTP = false;\\n    signup = false;\\n  }\\n  $: if (signup) {\\n    submitText = \\\"Signup New Account\\\";\\n  } else if (!isPhone && !isEmail && !showOTP) {\\n    submitText = \\\"Verify\\\";\\n  } else if (isPhone && !showOTP) {\\n    submitText = \\\"Verify Phone\\\";\\n  } else if (isEmail && !showOTP) {\\n    submitText = \\\"Verify Email\\\";\\n  } else if (isPhone && showOTP) {\\n    submitText = \\\"Verify OTP\\\";\\n  } else {\\n    submitText = \\\"Login Now\\\";\\n  }\\n  async function submit() {\\n    msg = err = null;\\n    if (!uid || uid == \\\"\\\") {\\n      err = \\\"Please enter your email/phone no\\\";\\n      return;\\n    }\\n    if (!isPhone && !isEmail) {\\n      err = \\\"Entered email is not valid\\\";\\n      return;\\n    }\\n    if (isPhone) {\\n      await phoneLogin();\\n    } else {\\n      await emailLogin();\\n    }\\n  }\\n  async function phoneLogin() {\\n    // toast.show({ show: true, color: \\\"err\\\", msg: \\\"error...\\\", duration: 7000 });\\n    loading = true;\\n    if (!showOTP) {\\n      // When clicked 1st time\\n      try {\\n        const otp = await get(\\\"users/phone/\\\" + uid);\\n        showOTP = true;\\n        msg = \\\"Please enter OTP sent to your Mobile\\\";\\n        // $refs.otp.focus();\\n        return;\\n      } catch (e) {\\n        err = e;\\n        console.log(\\\"err...\\\", e);\\n      } finally {\\n        loading = false;\\n      }\\n    } else {\\n      // Final submission\\n      try {\\n        loading = true;\\n        const u = await post(\\\"auth/local\\\", { uid, password: otp });\\n        $session.user = u.user;\\n        $session.token = u.token;\\n        cookies.set(\\\"token\\\", u.token);\\n        goto(\\\"/\\\");\\n      } catch (e) {\\n        err = e;\\n      } finally {\\n        loading = false;\\n      }\\n    }\\n  }\\n  async function emailLogin() {\\n    if (!showOTP) {\\n      // When clicked 1st time\\n      try {\\n        const otp = await get(\\\"users/email/\\\" + uid);\\n        showOTP = true;\\n        msg = \\\"Please enter your password\\\";\\n        // $refs.otp.focus();\\n        return;\\n      } catch (e) {\\n        if (e.response && e.response.status == \\\"400\\\") {\\n          signup = true;\\n          showOTP = true;\\n          console.log(\\\"400 err...\\\", e.response.status);\\n        } else {\\n          signup = true;\\n          showOTP = true;\\n          console.log(\\\"err...\\\", e.toString());\\n        }\\n        err = \\\"\\\";\\n      } finally {\\n        showOTP = true;\\n        loading = false;\\n      }\\n    } else {\\n      // Final submission\\n      try {\\n        loading = true;\\n        let u = {};\\n        if (signup) {\\n          // Signup\\n          u = await post(\\\"users\\\", {\\n            email: uid,\\n            firstName: firstName,\\n            lastName: lastName,\\n            password\\n          });\\n        } else {\\n          // Login\\n          u = await post(\\\"auth/local\\\", { uid, password });\\n        }\\n        $session.user = u.user;\\n        $session.token = u.token;\\n        cookies.set(\\\"token\\\", u.token);\\n        // showOTP = true;\\n        goto(\\\"/\\\");\\n        // $refs.password.focus();\\n      } catch (e) {\\n        showOTP = false;\\n        err = e;\\n        // $refs.uid.focus();\\n      } finally {\\n        showOTP = true;\\n        loading = false;\\n      }\\n    }\\n  }\\n</script>\\n\\n<style>\\n  .container {\\n    max-height: 80vh !important;\\n    min-height: 80vh !important;\\n  }\\n  .wraper-hide {\\n    visibility: hidden;\\n  }\\n  .otp-container {\\n    height: 48px;\\n    width: 136px;\\n    background-color: #eff1f4;\\n    border-radius: 4px;\\n    position: relative;\\n    display: inline-block;\\n  }\\n  .otp-container .otp-seperator {\\n    background-color: #dfe1e6;\\n    border: 1px solid #dfe1e6;\\n  }\\n  .otp-container #wraper1 {\\n    top: 20px;\\n    left: 28px;\\n  }\\n  .otp-container #wraper2 {\\n    top: 20px;\\n    left: 51px;\\n  }\\n  .otp-container #wraper3 {\\n    top: 20px;\\n    left: 76px;\\n  }\\n  .otp-container #wraper4 {\\n    top: 20px;\\n    left: 100px;\\n  }\\n  .otp-container .otp-content {\\n    height: inherit;\\n    width: 150px;\\n    background-color: transparent;\\n    border: 1px solid transparent;\\n    outline: transparent;\\n    letter-spacing: 15px;\\n    font-size: 22px;\\n    padding-left: 16px;\\n  }\\n</style>\\n\\n<svelte:head>\\n  <title>Login to Hopyshopy</title>\\n  <meta\\n    data-hid=\\\"description\\\"\\n    name=\\\"description\\\"\\n    content=\\\"Login to Hopyshopy\\\" />\\n  <meta data-hid=\\\"og:title\\\" name=\\\"og_title\\\" content=\\\"Login to Hopyshopy\\\" />\\n</svelte:head>\\n<main in:fadeIn out:fadeOut>\\n  <Header home={true} />\\n\\n  <div class=\\\"relative z-50\\\">\\n    <div class=\\\"h-full px-4\\\">\\n      <div class=\\\"container mx-auto flex items-center justify-center\\\">\\n        <div class=\\\"w-full md:w-1/2 lg:w-1/3 mb-6 rounded shadow-2xl\\\">\\n          <div>\\n            <p class=\\\"mb-2 p-2 text-xs bg-yellow-400 rounded\\\">\\n              SMS provider configured only for Indian Numbers. Please use email\\n              instead\\n            </p>\\n          </div>\\n          <div class=\\\"p-0 secondary text-white rounded rounded-b-none\\\">\\n            <h1 class=\\\"text-xl mb-6 text-left p-3\\\">\\n              {#if !signup}\\n                <span class=\\\"font-extrabold\\\">SIGN IN</span>\\n              {:else}\\n                <span class=\\\"font-extrabold\\\">SIGN UP</span>\\n                TO YOUR ACCOUNT\\n              {/if}\\n            </h1>\\n          </div>\\n          <form on:submit|preventDefault={submit} class=\\\"center bg-white\\\">\\n            <div class=\\\"p-6 lg:p-12\\\">\\n              {#if err}\\n                <div class=\\\"text-red-600 mb-5 text-center\\\">{err}</div>\\n              {:else if msg}\\n                <div class=\\\"text-green-600 mb-5 text-center\\\">{msg}</div>\\n              {/if}\\n              <Textbox bind:value={uid} label=\\\"Email/Phone\\\" />\\n              <br />\\n              {#if signup}\\n                <Textbox value={firstName} label=\\\"Fisrt Name\\\" class=\\\"w-full\\\" />\\n                <br />\\n                <Textbox value={lastName} label=\\\"Last Name\\\" class=\\\"w-full\\\" />\\n                <br />\\n              {/if}\\n              <!-- <p class=\\\"text-red-500 mb-5 text-xs font-hairline\\\">Please enter password</p> -->\\n\\n              {#if !isPhone && showOTP}\\n                <!-- Show password box -->\\n                <Passwordbox\\n                  bind:value={password}\\n                  label=\\\"Password\\\"\\n                  cls=\\\"w-full\\\" />\\n              {:else if showOTP}\\n                <!-- Show OTP box -->\\n                <div class=\\\" flex justify-center text-center\\\">\\n                  <div class=\\\"otp-container\\\">\\n                    <div\\n                      id=\\\"wraper1\\\"\\n                      class=\\\"otp-seperator w-1 h-1 rounded absolute\\\"\\n                      class:wraper-hide={otp.length > 0} />\\n                    <div\\n                      id=\\\"wraper2\\\"\\n                      class=\\\"otp-seperator w-1 h-1 rounded absolute\\\"\\n                      class:wraper-hide={otp.length > 1} />\\n                    <div\\n                      id=\\\"wraper3\\\"\\n                      class=\\\"otp-seperator w-1 h-1 rounded absolute\\\"\\n                      class:wraper-hide={otp.length > 2} />\\n                    <div\\n                      id=\\\"wraper4\\\"\\n                      class=\\\"otp-seperator w-1 h-1 rounded absolute\\\"\\n                      class:wraper-hide={otp.length > 3} />\\n                    <input\\n                      bind:value={otp}\\n                      name=\\\"otp\\\"\\n                      class=\\\"otp-content outline-none pl-4 otp-content w-32\\n                      bg-transparent border border-gray-400\\\"\\n                      maxlength=\\\"4\\\"\\n                      autocomplete=\\\"off\\\" />\\n                  </div>\\n                </div>\\n              {/if}\\n              <br />\\n              <br />\\n              <div class=\\\"flex items-center justify-between\\\">\\n                <button\\n                  type=\\\"submit\\\"\\n                  disabled={loading}\\n                  class=\\\"flex items-center justify-center h-14 text-2xl\\n                  outline-none w-full font-bold py-2 rounded primary\\\"\\n                  class:primary={!loading}\\n                  class:border={loading}>\\n                  {#if loading}\\n                    <img src=\\\"/loading.svg\\\" alt class:loading />\\n                  {:else}{submitText}{/if}\\n                </button>\\n              </div>\\n            </div>\\n          </form>\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n</main>\\n\"],\"names\":[],\"mappings\":\"AA8JE,UAAU,eAAC,CAAC,AACV,UAAU,CAAE,IAAI,CAAC,UAAU,CAC3B,UAAU,CAAE,IAAI,CAAC,UAAU,AAC7B,CAAC,AACD,YAAY,eAAC,CAAC,AACZ,UAAU,CAAE,MAAM,AACpB,CAAC,AACD,cAAc,eAAC,CAAC,AACd,MAAM,CAAE,IAAI,CACZ,KAAK,CAAE,KAAK,CACZ,gBAAgB,CAAE,OAAO,CACzB,aAAa,CAAE,GAAG,CAClB,QAAQ,CAAE,QAAQ,CAClB,OAAO,CAAE,YAAY,AACvB,CAAC,AACD,6BAAc,CAAC,cAAc,eAAC,CAAC,AAC7B,gBAAgB,CAAE,OAAO,CACzB,MAAM,CAAE,GAAG,CAAC,KAAK,CAAC,OAAO,AAC3B,CAAC,AACD,6BAAc,CAAC,QAAQ,eAAC,CAAC,AACvB,GAAG,CAAE,IAAI,CACT,IAAI,CAAE,IAAI,AACZ,CAAC,AACD,6BAAc,CAAC,QAAQ,eAAC,CAAC,AACvB,GAAG,CAAE,IAAI,CACT,IAAI,CAAE,IAAI,AACZ,CAAC,AACD,6BAAc,CAAC,QAAQ,eAAC,CAAC,AACvB,GAAG,CAAE,IAAI,CACT,IAAI,CAAE,IAAI,AACZ,CAAC,AACD,6BAAc,CAAC,QAAQ,eAAC,CAAC,AACvB,GAAG,CAAE,IAAI,CACT,IAAI,CAAE,KAAK,AACb,CAAC,AACD,6BAAc,CAAC,YAAY,eAAC,CAAC,AAC3B,MAAM,CAAE,OAAO,CACf,KAAK,CAAE,KAAK,CACZ,gBAAgB,CAAE,WAAW,CAC7B,MAAM,CAAE,GAAG,CAAC,KAAK,CAAC,WAAW,CAC7B,OAAO,CAAE,WAAW,CACpB,cAAc,CAAE,IAAI,CACpB,SAAS,CAAE,IAAI,CACf,YAAY,CAAE,IAAI,AACpB,CAAC\"}"
};

const _234234login = index.create_ssr_component(($$result, $$props, $$bindings, $$slots) => {
	let $session;
	const { session, page } = app.stores$1();
	$session = index.get_store_value(session);
	const cookies = Cookie();

	let loading = false,
		msg = null,
		signup = false,
		uid = "",
		password = "",
		firstName = "",
		lastName = "",
		otp = "",
		showOTP = false,
		phoneno = /^[+()\d-]+$/,
		submitText = "Verify",
		err = null;

	$$result.css.add(css);
	let $$settled;
	let $$rendered;

	do {
		$$settled = true;
		$session = index.get_store_value(session);
		let isEmail = uid.includes("@");
		let isPhone = uid.length >= 10 && uid.match(phoneno) ? true : false;

		$: {
			if (uid) {
				showOTP = false;
				signup = false;
			}
		}

		$: {
			if (signup) {
				submitText = "Signup New Account";
			} else if (!isPhone && !isEmail && !showOTP) {
				submitText = "Verify";
			} else if (isPhone && !showOTP) {
				submitText = "Verify Phone";
			} else if (isEmail && !showOTP) {
				submitText = "Verify Email";
			} else if (isPhone && showOTP) {
				submitText = "Verify OTP";
			} else {
				submitText = "Login Now";
			}
		}

		$$rendered = `${($$result.head += `<title>Login to Hopyshopy</title><meta data-hid="${"description"}" name="${"description"}" content="${"Login to Hopyshopy"}"><meta data-hid="${"og:title"}" name="${"og_title"}" content="${"Login to Hopyshopy"}">`, "")}
<main>
  ${index.validate_component(Header.Header, "Header").$$render($$result, { home: true }, {}, {})}

  <div class="${"relative z-50"}">
    <div class="${"h-full px-4"}">
      <div class="${"container mx-auto flex items-center justify-center svelte-14pnfkc"}">
        <div class="${"w-full md:w-1/2 lg:w-1/3 mb-6 rounded shadow-2xl"}">
          <div>
            <p class="${"mb-2 p-2 text-xs bg-yellow-400 rounded"}">
              SMS provider configured only for Indian Numbers. Please use email
              instead
            </p>
          </div>
          <div class="${"p-0 secondary text-white rounded rounded-b-none"}">
            <h1 class="${"text-xl mb-6 text-left p-3"}">
              ${!signup
		? `<span class="${"font-extrabold"}">SIGN IN</span>`
		: `<span class="${"font-extrabold"}">SIGN UP</span>
                TO YOUR ACCOUNT`}
            </h1>
          </div>
          <form class="${"center bg-white"}">
            <div class="${"p-6 lg:p-12"}">
              ${err
		? `<div class="${"text-red-600 mb-5 text-center"}">${index.escape(err)}</div>`
		: `${msg
			? `<div class="${"text-green-600 mb-5 text-center"}">${index.escape(msg)}</div>`
			: ``}`}
              ${index.validate_component(Textbox.Textbox, "Textbox").$$render(
			$$result,
			{ label: "Email/Phone", value: uid },
			{
				value: $$value => {
					uid = $$value;
					$$settled = false;
				}
			},
			{}
		)}
              <br>
              ${signup
		? `${index.validate_component(Textbox.Textbox, "Textbox").$$render(
				$$result,
				{
					value: firstName,
					label: "Fisrt Name",
					class: "w-full"
				},
				{},
				{}
			)}
                <br>
                ${index.validate_component(Textbox.Textbox, "Textbox").$$render(
				$$result,
				{
					value: lastName,
					label: "Last Name",
					class: "w-full"
				},
				{},
				{}
			)}
                <br>`
		: ``}
              

              ${!isPhone && showOTP
		? `
                ${index.validate_component(Passwordbox.Passwordbox, "Passwordbox").$$render(
				$$result,
				{
					label: "Password",
					cls: "w-full",
					value: password
				},
				{
					value: $$value => {
						password = $$value;
						$$settled = false;
					}
				},
				{}
			)}`
		: `${showOTP
			? `
                <div class="${" flex justify-center text-center"}">
                  <div class="${"otp-container svelte-14pnfkc"}">
                    <div id="${"wraper1"}" class="${[
					"otp-seperator w-1 h-1 rounded absolute svelte-14pnfkc",
					otp.length > 0 ? "wraper-hide" : ""
				].join(" ").trim()}"></div>
                    <div id="${"wraper2"}" class="${[
					"otp-seperator w-1 h-1 rounded absolute svelte-14pnfkc",
					otp.length > 1 ? "wraper-hide" : ""
				].join(" ").trim()}"></div>
                    <div id="${"wraper3"}" class="${[
					"otp-seperator w-1 h-1 rounded absolute svelte-14pnfkc",
					otp.length > 2 ? "wraper-hide" : ""
				].join(" ").trim()}"></div>
                    <div id="${"wraper4"}" class="${[
					"otp-seperator w-1 h-1 rounded absolute svelte-14pnfkc",
					otp.length > 3 ? "wraper-hide" : ""
				].join(" ").trim()}"></div>
                    <input name="${"otp"}" class="${"otp-content outline-none pl-4 otp-content w-32\n                      bg-transparent border border-gray-400 svelte-14pnfkc"}" maxlength="${"4"}" autocomplete="${"off"}"${index.add_attribute("value", otp, 1)}>
                  </div>
                </div>`
			: ``}`}
              <br>
              <br>
              <div class="${"flex items-center justify-between"}">
                <button type="${"submit"}" ${loading ? "disabled" : ""} class="${[
			"flex items-center justify-center h-14 text-2xl\n                  outline-none w-full font-bold py-2 rounded primary",
			(!loading ? "primary" : "") + " " + (loading ? "border" : "")
		].join(" ").trim()}">
                  ${loading
		? `<img src="${"/loading.svg"}" alt${index.add_classes([loading ? "loading" : ""].join(" ").trim())}>`
		: `${index.escape(submitText)}`}
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</main>`;
	} while (!$$settled);

	return $$rendered;
});

exports.default = _234234login;
